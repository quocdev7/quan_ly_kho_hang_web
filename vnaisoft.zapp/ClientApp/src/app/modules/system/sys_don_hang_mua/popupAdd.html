<div class="flex flex-0 items-center justify-between h-16 pr-3 sm:pr-5 pl-6 sm:pl-8 bg-primary text-on-primary">
    <div class="text-lg font-medium" transloco="NAV.sys_don_hang_mua"></div>
</div>

<mat-card class="w-full p-6 sm:p-8 space-y-1 overflow-y-auto">
    <div class="flex flex-row justify-end space-x-2 mr-4 mb-4">

        <button class="rounded py-2 px-4 font-bold  bg-primary-500  item2s-center hover:bg-primary-600"
            *ngIf="actionEnum!=3" [disabled]="loading" (click)="save()">
            <p transloco="save" class="mb-0 text-white"></p>
        </button>
        <button class="rounded py-2 px-8 font-bold  bg-primary-500  item2s-center hover:bg-primary-600"
            *ngIf="actionEnum==3" [disabled]="loading" (click)="openDialogPrint(record)">
            <p transloco="system.print" class="mb-0 text-white"></p>
        </button>
        <button class="rounded py-2 px-4 font-bold  bg-teal-500  hover:bg-teal-600  item2s-center" [disabled]="loading"
            (click)="close()">
            <p transloco="close" class="mb-0 text-white"></p>
        </button>
    </div>
    <!-- thong tin don hang -->
    <h3 transloco="system.thong_tin_don_hang" class="text-2xl font-bold underline"></h3>
    <div class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap">
        <div class="flex-1">
            <!-- <cm_input [errorModel]="errorModel" [actionEnum]="3" [label]="'system.ma_don_hang'"
                [keyError]="'db.ma_don_hang'" [type]="'readonly'" [(model)]="record.db.ma_don_hang">
            </cm_input> -->
            <mat-form-field class="w-full" floatLabel="always">
                <mat-label>
                    {{'system.ma_don_hang' | transloco}}
                </mat-label>
                <input matInput [(ngModel)]="record.db.ma" disabled="true">
                <!-- <button mat-icon-button color="primary" class="mr-4" (click)="get_code()" *ngIf="actionEnum == 1">
                    Làm mới
                </button> -->
            </mat-form-field>
        </div>

        <div class="flex-1">
            <mat-form-field class="w-full" floatLabel="always">
                <mat-label>
                    {{'system.ten_don_hang' | transloco}}
                </mat-label>
                <input matInput [(ngModel)]="record.db.ten" disabled="true">
                <!-- <button mat-icon-button color="primary" class="mr-4" (click)="get_code()" *ngIf="actionEnum==1">
                    Làm mới
                </button> -->
            </mat-form-field>
        </div>
    </div>
    <div class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap">
        <div class="flex-1">
            <cm_input [errorModel]="errorModel" [actionEnum]="actionEnum" 
                [keyError]="'db.ngay_dat_hang'"
                [label]="'system.ngay_dat_hang'" 
                [type]="'datepicker'" [readonly]="'false'"
                [(model)]="record.db.ngay_dat_hang"></cm_input>
        </div>
        <div class="flex-1">
            <mat-label for="" class="text-lg" style="font-weight: 450;" transloco="system.ghi_chu"></mat-label>
            <mat-form-field class="mt-1 fuse-mat-textarea fuse-mat-no-subscript w-full">
                <textarea maxlength="1000" matInput [rows]="3" [(ngModel)]="record.db.ghi_chu"
                    *ngIf="actionEnum ==3" disabled="true" [placeholder]="'Bấm vào đây để nhập'"
                    matTextareaAutosize></textarea>
                <textarea maxlength="1000" matInput [rows]="3" [(ngModel)]="record.db.ghi_chu"
                    *ngIf="actionEnum !=3" [placeholder]="'Bấm vào đây để nhập'" matTextareaAutosize></textarea>
            </mat-form-field>
        </div>
    </div>
    <h3 transloco="system.thong_tin_mat_hang" class="text-2xl font-bold underline"></h3>
    <div class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap">
        <div class="flex-1" *ngIf="actionEnum!=3">
            <div class="flex items-center border-b border-blue-500 py-2">
                <div class="flex w-full items-center justify-center bg-grey-lighter">
                    <label
                        class="w-full p-1 flex flex-row items-center bg-white text-blue rounded-lg tracking-wide uppercase  cursor-pointer hover:bg-blue-600 hover:text-white">
                        <svg class="w-8 h-8" fill="currentColor" xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 20 20">
                            <path
                                d="M16.88 9.1A4 4 0 0 1 16 17H5a5 5 0 0 1-1-9.9V7a3 3 0 0 1 4.52-2.59A4.98 4.98 0 0 1 17 8c0 .38-.04.74-.12 1.1zM11 11h3l-4-4-4 4h3v3h2v-3z" />
                        </svg>
                        &nbsp;&nbsp;
                        <span *ngIf="file" class="text-base leading-normal"> {{file.name}}</span>
                        <span *ngIf="!file" class="text-base leading-normal"> Chọn file để import</span>
                        <input type='file' class="hidden" (change)="onFileSelected($event)" #fileUpLoad />
                    </label>
                </div>

                <button
                    class="flex-shrink-0 border-transparent border-4 text-blue-500 hover:bg-blue-600 hover:text-white text-base py-1 px-2 rounded"
                    type="button" (click)="dowloadFileMau()">
                    <span transloco="system.import_form"></span>
                </button>
                <button
                    class="flex-shrink-0 border-transparent border-4 text-blue-500 hover:bg-blue-600 hover:text-white text-base py-1 px-2 rounded"
                    type="button" (click)="onSubmitFile($event)">
                    <span transloco="system.improt"></span>
                </button>
            </div>
        </div>
        
    </div>
    <br />
    <div class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap" *ngIf="actionEnum!=3">
        <div class="flex-1 mt-6">
            <mat-form-field class="w-full" floatLabel="always">
                <input matInput [(ngModel)]="ma_mat_hang" (keyup.enter)="add_mat_hang()"
                    placeholder="{{'system.nhap_ma_mat_hang' | transloco}}">

                <button mat-icon-button color="primary" class="mr-4" (click)="openDialogChooseMatHang()">
                    <span transloco="common.chon"></span>
                </button>
            </mat-form-field>
        </div>
        <div class="flex-1">
            <cm_input [errorModel]="errorModel" [actionEnum]="actionEnum" (keyup.enter)="add_mat_hang()"
                [keyError]="'so_luong_mh'" [label]="'system.so_luong'" [(model)]="record.so_luong_mh"
                [type]="'number'"></cm_input>
        </div>
    </div>
    <mat-label class="ml-2" *ngIf="actionEnum!=3">
        <span style="color: red" *ngFor="let item of errorModel | filter: 'key':'list_mat_hang'; index as i">
            (<span *ngFor="let msg of item.value"> {{ msg | transloco }} </span>)
        </span>
    </mat-label>
    <div class="w-full overflow-auto">
        <table class="cell-border hover w-full overflow-auto ">
            <thead class="bg-blue-500 text-center text-white h-8">
                <tr>
                    <th *ngIf="actionEnum !=3" style="width:50px"></th>
                    <th transloco="no_" style="width:50px"></th>
                    <th style="min-width: 140px"> <span transloco="system.mat_hang"></span></th>
                    <th transloco="system.so_luong" style="min-width: 100px"></th>
                    <th transloco="system.don_gia" style="min-width: 100px"></th>
                    <th transloco="system.so_luong_quy_doi" style="min-width: 100px"></th>
                    <th transloco="system.don_gia_quy_doi" style="min-width: 100px"></th>
                    <th transloco="system.chiet_khau" style="min-width: 100px"></th>
                    <th transloco="system.thanh_tien_sau_chiet_khau" style="min-width: 100px"></th>

                    <th style="min-width: 100px">
                        <span transloco="system.vat"></span> (%)
                    </th>
                    <th transloco="system.tien_thue" style="min-width: 100px"></th>
                    <th transloco="system.thanh_tien_sau_thue" style="min-width: 100px"></th>
                    <th transloco="system.ghi_chu"></th>
                </tr>
            </thead>
            <tbody *ngIf="record.db.list_mat_hang?.length != 0">
                <ng-container *ngFor="let item of record.list_mat_hang;  index as i;">
                    <tr>
                        <td *ngIf="actionEnum !=3" align="center">
                            <button color="warn" mat-raised-button transloco="delete"
                                (click)="delete_mat_hang(i,item.ten_mat_hang)">
                            </button>
                        </td>
                        <td style="text-align:center">{{i+1 }}</td>
                        <td>
                            <span class="text-blue-900 font-bold"> {{ item.ma_mat_hang }}</span>
                            <br />
                            <span>{{ item.ten_mat_hang }} </span>
                            <br *ngIf="actionEnum ==1" />
                            <span *ngIf="actionEnum ==1">
                                <span class="font-bold" transloco="system.ton_kho"></span>:
                                <span>{{item.ton_kho | number}}</span>
                            </span>
                        </td>
                        <td>
                            <cm_input [errorModel]="errorModel" [actionEnum]="actionEnum" [type]="'number'"
                                [keyError]="'so_luong'+i" [suffixstring]="item.ten_don_vi_tinh" [pos]="i"
                                [callbackChangeWithParamPos]="loadThanhTienSauThueMatHang.bind(this)"
                                [(model)]="item.db.so_luong">
                            </cm_input>
                        </td>
                        <td>
                            <cm_input [errorModel]="errorModel" [actionEnum]="actionEnum" [type]="'number'"
                                [keyError]="'don_gia'+i" [pos]="i"
                                [callbackChangeWithParamPos]="loadThanhTienSauThueMatHang.bind(this)"
                                [(model)]="item.db.don_gia"></cm_input>
                        </td>
                        <td>
                            <cm_input [errorModel]="errorModel" [actionEnum]="3" [type]="'number'"
                                [keyError]="'so_luong_quy_doi'+i" [suffixstring]="item.ten_don_vi_tinh" [pos]="i"
                                [callbackChangeWithParamPos]="loadThanhTienSauThueMatHang.bind(this)"
                                [(model)]="item.so_luong_quy_doi">
                            </cm_input>
                        </td>
                        <td>
                            <cm_input [errorModel]="errorModel" [actionEnum]="3" [type]="'number'"
                                [keyError]="'don_gia_quy_doi'+i" [pos]="i"
                                [callbackChangeWithParamPos]="loadThanhTienSauThueMatHang.bind(this)"
                                [(model)]="item.don_gia_quy_doi"></cm_input>
                        </td>
                        <td>
                            <cm_input [type]="'number'" [actionEnum]="actionEnum" [errorModel]="errorModel"
                                [keyError]="'chiet_khau'+i" [pos]="i"
                                [callbackChangeWithParamPos]="loadThanhTienSauThueMatHang.bind(this)"
                                [(model)]="item.db.chiet_khau"></cm_input>
                        </td>
                        <td>
                            <cm_input [type]="'number'" [actionEnum]="actionEnum" [errorModel]="errorModel"
                                [keyError]="'thanh_tien_chiet_khau'+i" [pos]="i"
                                [callbackChangeWithParamPos]="loadThanhTienSauThueMatHang.bind(this)"
                                [(model)]="item.db.thanh_tien_chiet_khau"></cm_input>
                        </td>
                        <td>
                            <cm_select [errorModel]="errorModel" [actionEnum]="actionEnum" [keyError]="'vat'+i"
                                [pos]="i" [listData]="list_vat"
                                [callbackChangeWithParamPos]="loadThanhTienSauThueMatHang.bind(this)"
                                [(model)]="item.db.vat">
                            </cm_select>
                        </td>
                        <td>
                            <cm_input [type]="'number'" [actionEnum]="actionEnum" [errorModel]="errorModel"
                                [keyError]="'tien_vat'+i" [pos]="i"
                                [callbackChangeWithParamPos]="loadThanhTienSauThueMatHangChangeTienThue.bind(this)"
                                [(model)]="item.db.tien_vat"></cm_input>
                        </td>
                        <td>
                            <cm_input [type]="'number'" [actionEnum]="actionEnum" [errorModel]="errorModel"
                                [keyError]="'thanh_tien_sau_thue'+i" [pos]="i"
                                [callbackChangeWithParamPos]="loadThanhTienSauThueMatHang.bind(this)"
                                [(model)]="item.db.thanh_tien_sau_thue"></cm_input>
                        </td>
                        <td>
                            <cm_input [type]="'text'" [actionEnum]="actionEnum" [(model)]="item.db.ghi_chu">
                            </cm_input>
                        </td>
                    </tr>
                </ng-container>

                <tr class="mt-5">
                    <td colspan="5" align="right">
                        <span class="font-bold  text-blue-600" transloco="system.chi_phi_van_chuyen"></span>
                    </td>
                    <td colspan="8" align="right" class="font-bold">
                        {{record.chi_phi_van_chuyen | number}}
                    </td>
                </tr>
                <tr class="mt-5">
                    <td colspan="5" align="right">
                        <span span class="font-bold text-blue-600">Tổng</span>&nbsp;<span
                            class="font-bold  text-blue-600"
                            transloco="system.thanh_tien_sau_chiet_khau"></span>&nbsp;<span
                            class="font-bold  text-blue-600">(bao gồm phí vận chuyển)</span>
                    </td>
                    <td colspan="8" align="right" class="font-bold">
                        {{record.db.tong_tien_sau_chiet_khau | number}}
                    </td>
                </tr>
                <tr>
                    <td colspan="5" align="right">

                        <span span class="font-bold text-blue-600">Tổng</span>&nbsp;<span
                            class="font-bold  text-blue-600" transloco="system.tien_thue"></span>&nbsp;<span
                            class="font-bold  text-blue-600">(bao gồm thuế vận chuyển)</span>
                    </td>
                    <td colspan="8" align="right" class="font-bold">
                        {{record.db.tong_tien_thue | number}}
                    </td>
                </tr>
                <tr>
                    <td colspan="5" align="right">
                        <span span class="font-bold text-blue-600">Tổng</span>&nbsp;<span
                            class="font-bold  text-blue-600"
                            transloco="system.thanh_tien_sau_thue"></span>&nbsp;<span
                            class="font-bold  text-blue-600">(bao gồm phí vận chuyển)</span>
                    </td>
                    <td colspan="8" align="right" class="font-bold">
                        {{record.db.tong_tien_sau_thue | number}}
                    </td>
                </tr>

            </tbody>

        </table>
    </div>
    <div class="flex flex-row justify-end space-x-2 mr-4 py-4">
        <button class="rounded py-2 px-4 font-bold  bg-primary-500  item2s-center hover:bg-primary-600"
            *ngIf="actionEnum!=3" [disabled]="loading" (click)="save()">
            <p transloco="save" class="mb-0 text-white"></p>
        </button>
        <button class="rounded py-2 px-8 font-bold  bg-primary-500  item2s-center hover:bg-primary-600"
            *ngIf="actionEnum==3" [disabled]="loading" (click)="openDialogEdit(record)">
            <p transloco="system.edit" class="mb-0 text-white"></p>
        </button>
        <button class="rounded py-2 px-8 font-bold  bg-primary-500  item2s-center hover:bg-primary-600"
            *ngIf="actionEnum==3" [disabled]="loading" (click)="openDialogPrint(record)">
            <p transloco="system.print" class="mb-0 text-white"></p>
        </button>
        <button class="rounded py-2 px-4 font-bold  bg-teal-500  hover:bg-teal-600  item2s-center"
            [disabled]="loading" (click)="close()">
            <p transloco="close" class="mb-0 text-white"></p>
        </button>
    </div>
</mat-card>